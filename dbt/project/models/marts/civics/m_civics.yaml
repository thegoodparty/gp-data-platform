version: 2

models:
  - name: users
    description: >
      Goodparty.org application users, with aggregate campaign counts appended.

      Grain: One row per user.

      Limitations: Win/loss outcome data requires future work and is not included in this MVP.

    columns:
      - name: user_id
        description: Primary key - unique user identifier from gp-api production database
        data_tests:
          - unique
          - not_null

      - name: email
        description: User's email address (primary contact, unique identifier)

      - name: first_name
        description: User's first name

      - name: last_name
        description: User's last name

      - name: phone
        description: User's phone number

      - name: zip
        description: User's zip code

      - name: created_at
        description: Timestamp when user account was created (signup date)

      - name: updated_at
        description: Timestamp when user account was last updated

      - name: campaign_count
        description: Total number of campaigns created by this user

      - name: non_demo_campaign_count
        description: Number of non-demo campaigns (use for production counts)

      - name: verified_campaign_count
        description: Number of verified campaigns

      - name: active_campaign_count
        description: Number of active campaigns

      - name: pro_campaign_count
        description: Number of pro-tier campaigns

      - name: pledged_campaign_count
        description: Number of campaigns where candidate took the GoodParty pledge

      - name: first_campaign_created_at
        description: Timestamp of user's first campaign creation

      - name: last_campaign_created_at
        description: Timestamp of user's most recent campaign creation

      - name: has_campaign
        description: Whether user has created at least one campaign
        data_tests:
          - not_null

      - name: has_verified_campaign
        description: Whether user has at least one verified campaign
        data_tests:
          - not_null

      - name: has_pledged_campaign
        description: Whether user has at least one pledged campaign
        data_tests:
          - not_null

      - name: is_serve_user
        description: >
          Whether the user is a "Serve" user. A user is considered a Serve user
          if they have created a poll through an elected office and the poll has
          been completed (is_completed = true).  This approximates a user
          creating a poll and viewing their results, which is the current
          definition for Serve platform usage. Note: Whether users actually
          viewed their results is tracked in Amplitude, not in the product
          database, so this flag uses poll completion as a proxy for viewing
          results.
        data_tests:
          - not_null

  - name: campaigns
    description: >
      Goodparty.org application campaigns.

      One row per campaign with user information denormalized.

      Grain: One row per campaign.

      Limitations: Win/loss outcome data requires future work and is not included in this MVP.

    columns:
      - name: campaign_id
        description: Primary key - unique campaign identifier from gp-api production database
        data_tests:
          - unique
          - not_null

      - name: campaign_slug
        description: URL-friendly campaign identifier used in app URLs

      - name: user_id
        description: Foreign key to user table - the user who owns this campaign
        data_tests:
          - not_null

      - name: user_email
        description: User's email address (primary contact)

      - name: user_first_name
        description: User's first name

      - name: user_last_name
        description: User's last name

      - name: user_phone
        description: User's phone number

      - name: user_zip
        description: User's zip code

      - name: user_created_at
        description: Timestamp when user account was created (signup date)

      - name: created_at
        description: Timestamp when this campaign was created

      - name: updated_at
        description: Timestamp when this campaign was last updated

      - name: is_verified
        description: Whether the campaign has been verified by GoodParty staff
        data_tests:
          - not_null

      - name: is_active
        description: Whether the campaign is currently active

      - name: is_pro
        description: Whether the campaign is on pro tier

      - name: is_demo
        description: Whether the campaign is a demo/test account (exclude from production counts)

      - name: is_pledged
        description: Whether the candidate has taken the GoodParty pledge

      - name: election_date
        description: Date of the election the campaign is targeting

      - name: campaign_state
        description: U.S. state where the campaign is running

      - name: campaign_office
        description: Political office the candidate is running for

      - name: campaign_party
        description: Political party affiliation

      - name: election_level
        description: Level of election (local, state, federal)

      - name: ballotready_position_id
        description: >
          The numeric identifier for the political position (office) in BallotReady's
          database. This ID is extracted from the base64-encoded `positionId` stored
          in the campaign details, which originates from BallotReady's GraphQL API.
          BallotReady is a third-party service that provides comprehensive election
          and ballot data. This ID can be used to join with BallotReady position data
          for additional office metadata such as filing deadlines, term lengths,
          geographic boundaries, and partisan type.

  - name: elections
    description: >
      Elections represent a full election cycle for a specific position in a specific year.
      Encompasses all stages (primary, general, runoff).

      Grain: One row per position + year.

      Example: "Seattle Mayor 2026" (the entire election cycle)

    columns:
      - name: gp_election_id
        description: Primary key - unique election identifier (UUID)
        data_tests:
          - unique
          - not_null

      - name: br_position_id
        description: BallotReady position ID (closest equivalent to election in BR)

      - name: election_year
        description: Year of the election

      - name: position_name
        description: Full name of the position/office

      - name: normalized_position_name
        description: Standardized position name from BallotReady

      - name: candidate_office
        description: Candidate-friendly office title

      - name: office_level
        description: Office hierarchy level (local, city, county, state, federal)

      - name: office_level_formatted
        description: Office level with proper casing

      - name: state_code
        description: Two-letter state code

      - name: state_name
        description: Full state name

      - name: city
        description: City name if applicable

      - name: sub_area_name
        description: Sub-area type (e.g., District, Ward)

      - name: sub_area_value
        description: Sub-area value (e.g., district number)

      - name: mtfcc
        description: MAF/TIGER Feature Class Code for geographic classification

      - name: number_of_seats
        description: Number of seats available in this election

      - name: is_judicial
        description: Whether this is a judicial election

      - name: created_at
        description: Earliest candidacy creation timestamp for this election

      - name: updated_at
        description: Most recent candidacy update timestamp for this election

  - name: election_stages
    description: >
      Election Stages represent individual phases within an election (primary, general, or runoff).

      Grain: One row per election stage (race).

      Example: "Seattle Mayor 2026 Primary" or "Seattle Mayor 2026 General"

    columns:
      - name: gp_election_stage_id
        description: Primary key - unique election stage identifier (UUID)
        data_tests:
          - unique
          - not_null

      - name: gp_election_id
        description: Foreign key to elections table
        data_tests:
          - not_null

      - name: br_race_id
        description: BallotReady race ID

      - name: ddhq_race_id
        description: DDHQ race ID (NULL placeholder for future integration)

      - name: stage_type
        description: Type of election stage - Primary, General, or Runoff

      - name: election_date
        description: Date of this election stage

      - name: election_stage_name
        description: Full name of the election stage

      - name: is_primary
        description: Whether this is a primary election stage

      - name: is_runoff
        description: Whether this is a runoff election stage

      - name: is_retention
        description: Whether this is a retention election

      - name: created_at
        description: Earliest candidacy creation timestamp for this stage

      - name: updated_at
        description: Most recent candidacy update timestamp for this stage

  - name: candidates
    description: >
      Candidates represent individual persons who run or have run for office.

      Grain: One row per unique person.

      Example: "John Smith" (regardless of how many elections they've run in)

    columns:
      - name: gp_candidate_id
        description: Primary key - unique candidate identifier (UUID)
        data_tests:
          - unique
          - not_null

      - name: br_candidate_id
        description: BallotReady person/candidate ID

      - name: first_name
        description: Candidate's first name

      - name: middle_name
        description: Candidate's middle name

      - name: last_name
        description: Candidate's last name

      - name: suffix
        description: Candidate's name suffix (Jr., Sr., III, etc.)

      - name: nickname
        description: Candidate's nickname

      - name: email
        description: Candidate's email address (most recent)

      - name: phone
        description: Candidate's phone number (most recent)

      - name: image_url
        description: URL to candidate's profile image

      - name: product_user_id
        description: Foreign key to Win product user (NULL placeholder for future integration)

      - name: hs_contact_id
        description: HubSpot contact ID (NULL placeholder for future integration)

      - name: created_at
        description: Timestamp of first candidacy record

      - name: updated_at
        description: Timestamp of most recent candidacy record

  - name: candidacies
    description: >
      Candidacies represent a specific instance of a candidate running for a particular
      position in a particular year. A Candidacy comprises a Candidate and an Election.

      Grain: One row per candidate + election (person + position + year).

      Example: "John Smith for Seattle Mayor 2026"

    columns:
      - name: gp_candidacy_id
        description: Primary key - unique candidacy identifier (UUID)
        data_tests:
          - unique
          - not_null

      - name: gp_candidate_id
        description: Foreign key to candidates table
        data_tests:
          - not_null

      - name: gp_election_id
        description: Foreign key to elections table
        data_tests:
          - not_null

      - name: br_candidate_id
        description: BallotReady candidate/person ID

      - name: br_position_id
        description: BallotReady position ID

      - name: party
        description: Political party affiliation

      - name: is_independent_or_nonpartisan
        description: Whether candidate is Independent or Nonpartisan

      - name: is_major_party
        description: Whether candidate belongs to a major party (Democrat/Republican)

      - name: civicengine_tier
        description: BallotReady/CivicEngine tier classification

      - name: product_campaign_id
        description: Foreign key to Win product campaign (NULL placeholder for future integration)

      - name: hs_company_id
        description: HubSpot company ID (NULL placeholder for future integration)

      - name: created_at
        description: Earliest candidacy stage creation timestamp

      - name: updated_at
        description: Most recent candidacy stage update timestamp

  - name: candidacy_stages
    description: >
      Candidacy Stages represent the intersection of a candidacy and a specific election stage.
      Contains vendor-specific IDs and stage-specific results.

      Grain: One row per candidacy per election stage.

      Example: "John Smith for Seattle Mayor 2026, Primary Results"

    columns:
      - name: gp_candidacy_stage_id
        description: Primary key - unique candidacy stage identifier (UUID)
        data_tests:
          - unique
          - not_null

      - name: gp_candidacy_id
        description: Foreign key to candidacies table
        data_tests:
          - not_null

      - name: gp_election_stage_id
        description: Foreign key to election_stages table
        data_tests:
          - not_null

      - name: br_candidacy_id
        description: BallotReady candidacy ID (candidacy-stage level)

      - name: ddhq_candidacy_id
        description: DDHQ candidacy ID (NULL placeholder for future integration)

      - name: candidacy_stage_result
        description: Result for this candidacy in this stage (WON, LOST, etc.)

      - name: votes_received
        description: Number of votes received in this stage (NULL placeholder for future DDHQ integration)

      - name: vote_percentage
        description: Percentage of votes received in this stage (NULL placeholder for future DDHQ integration)

      - name: hs_contact_id
        description: HubSpot contact ID (NULL placeholder for future integration)

      - name: created_at
        description: Record creation timestamp

      - name: updated_at
        description: Record last update timestamp
