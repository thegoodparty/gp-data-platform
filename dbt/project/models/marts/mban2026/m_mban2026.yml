version: 2

models:
  - name: deid_voters
    description: |
      De-identified nationwide voter data for MBAN Analytics program (2026).

      This dataset provides comprehensive voter information with personally identifiable
      information (PII) removed or hashed to protect individual privacy while maintaining
      analytical utility for educational purposes.

      **De-identification Strategy:**
      - Names (First, Middle, Last) removed
      - Contact information (phone numbers, email) removed
      - Phone confidence scores removed as superfluous (CellConfidenceCode, LandlineConfidenceCode)
      - Physical address lines hashed into household identifiers (mailing_household_hash, residence_household_hash)
      - Voter ID (LALVOTERID) retained for record linkage
      - Geographic aggregates (city, state, zip only) retained for analysis
      - Detailed address components removed (street names, apartment numbers, zip+4, etc.)
      - Coordinates rounded to 3 decimal places (~100m precision)
      - Superfluous string versions of numeric fields removed (Age, Estimated_Income_Amount) to retain only integer versions
      - Sequence/ordering fields removed (SequenceOddEven, SequenceZigZag)

      **Data Source:** m_people_api__voter (L2 Political nationwide voter file)

      **Use Cases:**
      - Voter turnout analysis and modeling
      - Demographic and geographic voting pattern analysis
      - Electoral district analysis
      - Educational analytics projects

    columns:
      - name: id
        description: Unique identifier for voter record (salted UUID from LALVOTERID)
        tests:
          - not_null
          - unique

      - name: LALVOTERID
        description: L2 Political voter ID (retained for linkage)
        tests:
          - not_null
          - unique

      - name: State
        description: State postal code
        tests:
          - not_null

      - name: mailing_household_hash
        description: |
          SHA-256 hash of concatenated mailing address components
          (house number, address lines, apartment info, city, state, zip).
          Provides household-level identifier without exposing actual address.
        tests:
          - not_null

      - name: residence_household_hash
        description: |
          SHA-256 hash of concatenated residence address components
          (house number, address lines, apartment info, city, state, zip).
          Provides household-level identifier without exposing actual address.
        tests:
          - not_null

      - name: Mailing_Families_FamilyID
        description: Family identifier for mailing address

      - name: Age_Int
        description: Voter age as integer

      - name: Gender
        description: Voter gender

      - name: Parties_Description
        description: Political party affiliation

      - name: Voter_Status
        description: |
          Voter engagement status based on recent turnout:
          - First Time: No votes in last 10 elections
          - Unlikely: No votes in last 3 elections
          - Likely: 2 votes in last 3 elections
          - Super: 3 votes in last 3 elections
          - Unknown: Other patterns

      - name: Residence_Addresses_Latitude
        description: Residence latitude rounded to 3 decimal places (~100m precision)

      - name: Residence_Addresses_Longitude
        description: Residence longitude rounded to 3 decimal places (~100m precision)

      - name: Residence_Addresses_City
        description: Residence city

      - name: Residence_Addresses_State
        description: Residence state

      - name: Residence_Addresses_Zip
        description: Residence ZIP code

      - name: US_Congressional_District
        description: U.S. Congressional district

      - name: State_Senate_District
        description: State Senate district

      - name: State_House_District
        description: State House district

      - name: General_2024
        description: Voted in 2024 General election (boolean)

      - name: General_2022
        description: Voted in 2022 General election (boolean)

      - name: General_2020
        description: Voted in 2020 General election (boolean)

      - name: created_at
        description: Record creation timestamp
        tests:
          - not_null

      - name: updated_at
        description: Record last update timestamp
        tests:
          - not_null

  - name: candidates_outreach
    description: |
      Candidate outreach data for MBAN Analytics program (2026).

      This dataset combines HubSpot company records (representing candidacies) with
      text-based outreach campaign data from the GoodParty product database. It enables
      analysis of candidate outreach effectiveness and campaign engagement patterns.

      **Data Scope:**
      - Includes all HubSpot companies (candidacies)
      - Outreach data filtered to text campaigns starting from 2023-01-01
      - HubSpot companies without matching outreach campaigns will have null outreach fields

      **Data Sources:**
      - HubSpot API Companies (candidacy-level information including election results)
      - GoodParty API Outreach (text outreach campaign data)
      - GoodParty API Campaign (links outreach to HubSpot via hubspotId)

      **Use Cases:**
      - Analyzing text outreach campaign effectiveness
      - Correlating outreach activity with election outcomes
      - Understanding candidate engagement patterns by office level/type
      - Measuring viability score relationships to outreach volume

    columns:
      - name: hubspot_id
        description: Unique identifier for the HubSpot company record (candidacy)
        data_tests:
          - not_null

      - name: state
        description: U.S. state where the candidate is running for office

      - name: viability_score
        description: |
          Viability score (version 2.0) indicating the candidate's likelihood of success.
          Higher scores indicate greater viability.

      - name: candidate_office
        description: The office the candidate is running for (e.g., "City Council", "Mayor")

      - name: official_office_name
        description: The official name of the position/office

      - name: office_level
        description: |
          Level of government for the office (e.g., "CITY", "COUNTY", "STATE").
          Indicates the scope of the elected position.

      - name: office_type
        description: |
          Type classification of the office (e.g., "Utilities Commissioner",
          "City Council Member"). More specific than office_level.

      - name: election_date
        description: Date of the election for this candidacy

      - name: general_election_result
        description: |
          Outcome of the general election for this candidate.
          Values include "Won General", "Lost General", etc.

      - name: general_votes_received
        description: Number of votes the candidate received in the general election

      - name: total_general_votes_cast
        description: Total number of votes cast in the general election for this race

      - name: is_uncontested
        description: |
          Whether the race was uncontested.
          Values: "Contested", "Uncontested", null

      - name: outreach_id
        description: |
          Unique identifier for the outreach campaign.
          Null if no text outreach exists for this HubSpot company.

      - name: campaign_id
        description: |
          Foreign key to the GoodParty campaign table.
          Links outreach to the product campaign.

      - name: outreach_name
        description: Name of the outreach campaign

      - name: outreach_title
        description: Title of the outreach campaign

      - name: script
        description: Script or content template used for the outreach

      - name: outreach_status
        description: Current status of the outreach campaign (e.g., active, completed)

      - name: outreach_type
        description: |
          Type of outreach. Filtered to "text" only in this dataset.
          Original values include: phone, text, email, door-to-door

      - name: outreach_date
        description: Date the outreach campaign was created or scheduled

      - name: message
        description: Message content sent in the outreach

      - name: phone_list_id
        description: ID of the phone list used for targeting the outreach

      - name: audience_request
        description: JSON containing audience targeting parameters for the outreach

      - name: voter_file_filter_id
        description: ID of the voter file filter applied to target recipients

      - name: outreach_created_at
        description: Timestamp when the outreach campaign was created

      - name: outreach_updated_at
        description: Timestamp when the outreach campaign was last updated

  - name: mban_election_results
    description: |
      DDHQ election results data for MBAN Analytics program (2026).

      This dataset provides election results from Decision Desk HQ (DDHQ), including
      candidate vote totals, winner status, and race-level information. It serves as
      a pass-through of the staging table for direct analytical use.

      **Data Source:** DDHQ Google Drive election results (stg_airbyte_source__ddhq_gdrive_election_results)

      **Use Cases:**
      - Historical election results analysis
      - Winner/loser outcome analysis
      - Vote share and margin calculations
      - Contested vs uncontested race analysis
      - Multi-seat election analysis

    columns:
      - name: race_id
        description: Unique identifier for the race from DDHQ
        data_tests:
          - not_null

      - name: candidate_id
        description: Unique identifier for the candidate from DDHQ

      - name: candidate
        description: Name of the candidate

      - name: candidate_party
        description: Political party affiliation of the candidate

      - name: race_name
        description: Name/title of the race (e.g., "Mayor", "City Council District 1")

      - name: election_type
        description: |
          Type of election (e.g., "General", "Primary", "Runoff").
          Indicates the stage of the electoral process.

      - name: date
        description: Date of the election

      - name: votes
        description: Number of votes received by the candidate in this race

      - name: is_winner
        description: |
          Whether the candidate won the race.
          Boolean flag indicating victory status.

      - name: is_uncontested
        description: |
          Whether the race was uncontested.
          Boolean flag - true if only one candidate ran.

      - name: number_of_seats_in_election
        description: |
          Number of seats available in this election.
          Greater than 1 for multi-member districts or at-large elections.

      - name: total_number_of_ballots_in_race
        description: Total number of ballots cast in this race

  - name: mban_candidacy_election_results
    description: |
      DDHQ election match results surfaced per HubSpot candidacy for MBAN Analytics program (2026).

      This model bridges HubSpot candidacies to DDHQ election data via AI-powered matching
      (int__gp_ai_election_match). Each candidacy can have multiple rows for different
      election stages (general, primary, runoff).

      **Grain:** One row per (hubspot_id, election_date, election_type)

      **Data Sources:**
      - int__hubspot_companies_w_contacts_2025 (company_id â†’ gp_candidacy_id mapping)
      - int__gp_ai_election_match (AI-powered DDHQ match data)

      **Use Cases:**
      - Linking candidacies to their DDHQ election match
      - Analyzing match quality via confidence scores and reasoning
      - Join to candidates_outreach via hubspot_id for candidacy details
      - Join to mban_election_results via ddhq_race_id + ddhq_candidate_id for vote totals

    columns:
      - name: hubspot_id
        description: HubSpot company ID representing the candidacy. Join key to candidates_outreach.
        data_tests:
          - not_null

      - name: gp_candidacy_id
        description: Unique candidacy identifier derived from candidate + election attributes
        data_tests:
          - not_null

      - name: election_date
        description: Date of the election for this candidacy
        data_tests:
          - not_null

      - name: election_type
        description: |
          Type of election stage (general, primary, or runoff).
          Comes from the AI election match model.
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - general
                  - primary
                  - runoff

      - name: has_match
        description: Whether the AI matching process found a DDHQ match for this candidacy/election

      - name: match_confidence
        description: LLM confidence score for the DDHQ match quality

      - name: match_reasoning
        description: LLM reasoning explaining why this DDHQ candidate was matched

      - name: ddhq_race_id
        description: DDHQ race identifier. Join key to mban_election_results.race_id.

      - name: ddhq_candidate_id
        description: DDHQ candidate identifier. Join key to mban_election_results.candidate_id.

    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - hubspot_id
            - election_date
            - election_type
